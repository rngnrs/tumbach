{"version":3,"sources":["markup/shitty.js"],"names":["RX_SYMBOL","RX_WORD","processStrikedOutShitty","info","match","find","s","index","length","replace","insert","processStrikedOutShittyWord","txt","text","count","pcount","test","convertTooltipShitty","_1","_2","matchs","_3","options","type","NO_SKIP","tooltip","op","cl","priority","markupModes","process","convert"],"mappings":";;;;;;AAAA;;;;;;AAEA,IAAMA,YAAY,UAAlB;AACA,IAAMC,UAAU,UAAhB;;AAEA,SAASC,uBAAT,CAAiCC,IAAjC,EAAuC;AACrC,MAAIC,QAAQD,KAAKE,IAAL,CAAUL,SAAV,CAAZ;AACA,SAAOI,KAAP,EAAc;AACZ,QAAIE,IAAIF,MAAMG,KAAN,GAAeH,MAAM,CAAN,EAASI,MAAT,GAAkB,CAAzC;AACA,QAAIF,IAAI,CAAR,EAAW;AACTF,cAAQD,KAAKE,IAAL,CAAUL,SAAV,EAAqBI,MAAMG,KAAN,GAAcH,MAAM,CAAN,EAASI,MAA5C,CAAR;AACA;AACD;AACDL,SAAKM,OAAL,CAAaL,MAAMG,KAAnB,EAA0BH,MAAM,CAAN,EAASI,MAAnC,EAA2C,MAA3C,EAAmD,CAAnD;AACAL,SAAKO,MAAL,CAAYJ,CAAZ,EAAe,KAAf;AACAF,YAAQD,KAAKE,IAAL,CAAUL,SAAV,EAAqBI,MAAMG,KAAN,GAAc,CAAnC,CAAR;AACD;AACF;;AAED,SAASI,2BAAT,CAAqCR,IAArC,EAA2C;AACzC,MAAIC,QAAQD,KAAKE,IAAL,CAAUJ,OAAV,CAAZ;AACA,MAAIW,MAAMT,KAAKU,IAAf;AACA,SAAOT,KAAP,EAAc;AACZ,QAAIU,QAAQV,MAAM,CAAN,EAASI,MAAT,GAAkB,CAA9B;AACA,QAAIO,SAASD,KAAb;AACA,QAAIR,IAAIF,MAAMG,KAAN,GAAc,CAAtB;AACA,WAAOO,QAAQ,CAAf,EAAkB;AAChB,aAAOR,KAAK,CAAL,IAAU,KAAKU,IAAL,CAAUJ,IAAIN,CAAJ,CAAV,CAAjB,EAAoC;AAClC,UAAEA,CAAF;AACD;AACD,aAAOA,KAAK,CAAL,IAAU,CAAC,KAAKU,IAAL,CAAUJ,IAAIN,CAAJ,CAAV,CAAlB,EAAqC;AACnC,UAAEA,CAAF;AACD;AACD,QAAEQ,KAAF;AACD;AACDX,SAAKM,OAAL,CAAaL,MAAMG,KAAnB,EAA0BH,MAAM,CAAN,EAASI,MAAnC,EAA2C,MAA3C,EAAmD,CAAnD;AACAL,SAAKO,MAAL,CAAYJ,IAAI,CAAhB,EAAmB,KAAnB;AACAF,YAAQD,KAAKE,IAAL,CAAUJ,OAAV,EAAmBG,MAAMG,KAAN,GAAe,IAAIQ,MAAtC,CAAR;AACD;AACF;;AAED,SAASE,oBAAT,CAA8BC,EAA9B,EAAkCC,EAAlC,EAAsCC,MAAtC,EAA8CC,EAA9C,EAAkDC,OAAlD,EAA2D;AACzDA,UAAQC,IAAR,GAAe,4BAAkBC,OAAjC;AACA,MAAIC,UAAUL,OAAO,CAAP,CAAd;AACAE,UAAQI,EAAR,wDAA6DD,OAA7D;AACAH,UAAQK,EAAR,GAAa,SAAb;AACA,SAAOP,OAAO,CAAP,CAAP;AACD;;kBAEc,CAAC;AACdQ,YAAU,IADI;AAEdC,eAAa,CAAC,sBAAD,EAAyB,SAAzB,CAFC;AAGdC,WAAS5B;AAHK,CAAD,EAIZ;AACD0B,YAAU,IADT;AAEDC,eAAa,CAAC,sBAAD,EAAyB,SAAzB,CAFZ;AAGDC,WAASnB;AAHR,CAJY,EAQZ;AACDiB,YAAU,IADT;AAEDC,eAAa,CAAC,sBAAD,EAAyB,SAAzB,CAFZ;AAGDE,WAASd,oBAHR;AAIDS,MAAI,4BAJH;AAKDC,MAAI;AALH,CARY,C","file":"markup/shitty.js","sourcesContent":["import ProcessingContext from './processing-context';\n\nconst RX_SYMBOL = /(\\^H)+/gi;\nconst RX_WORD = /(\\^W)+/gi;\n\nfunction processStrikedOutShitty(info) {\n  let match = info.find(RX_SYMBOL);\n  while (match) {\n    let s = match.index - (match[0].length / 2);\n    if (s < 0) {\n      match = info.find(RX_SYMBOL, match.index + match[0].length);\n      continue;\n    }\n    info.replace(match.index, match[0].length, '</s>', 0);\n    info.insert(s, '<s>');\n    match = info.find(RX_SYMBOL, match.index + 7);\n  }\n}\n\nfunction processStrikedOutShittyWord(info) {\n  let match = info.find(RX_WORD);\n  let txt = info.text;\n  while (match) {\n    let count = match[0].length / 2;\n    let pcount = count;\n    let s = match.index - 1;\n    while (count > 0) {\n      while (s >= 0 && /\\s/.test(txt[s])) {\n        --s;\n      }\n      while (s >= 0 && !/\\s/.test(txt[s])) {\n        --s;\n      }\n      --count;\n    }\n    info.replace(match.index, match[0].length, '</s>', 0);\n    info.insert(s + 1, '<s>');\n    match = info.find(RX_WORD, match.index + (7 * pcount));\n  }\n}\n\nfunction convertTooltipShitty(_1, _2, matchs, _3, options) {\n  options.type = ProcessingContext.NO_SKIP;\n  let tooltip = matchs[2];\n  options.op = `<span class='tooltip js-with-tooltip' title='${tooltip}'>`;\n  options.cl = '</span>';\n  return matchs[1];\n}\n\nexport default [{\n  priority: 1900,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  process: processStrikedOutShitty\n}, {\n  priority: 2000,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  process: processStrikedOutShittyWord\n}, {\n  priority: 2100,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertTooltipShitty,\n  op: /([^\\?\\s]+)\\?{3}\"([^\"]+)\"/gi,\n  cl: null\n}];\n"],"sourceRoot":"/source/"}