{"version":3,"sources":["helpers/vk.js"],"names":["Tools","VK_API_CALL_TIMEOUT","MINUTE","method","params","Promise","reject","Error","translate","access_token","map","value","key","isArray","v","join","request","url","timeout","response","status","body","read","data","resolve","JSON","parse","toString"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;IACYA,K;;;;;;;;AAGZ,IAAMC,sBAAsBD,MAAME,MAAlC;;;uDAEe,iBAAeC,MAAf,EAAuBC,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACRD,MADQ;AAAA;AAAA;AAAA;;AAAA,6CAEJE,QAAQC,MAAR,CAAe,IAAIC,KAAJ,CAAUP,MAAMQ,SAAN,CAAgB,uBAAhB,CAAV,CAAf,CAFI;;AAAA;AAIbJ,qBAASA,UAAU,EAAnB;AACAA,mBAAOK,YAAP,GAAsB,IAVZT,KAUY,UAAO,4BAAP,CAAtB;AACAI,qBAAS,0BAAEA,MAAF,EAAUM,GAAV,CAAc,UAACC,KAAD,EAAQC,GAAR,EAAgB;AACrC,kBAAI,CAAC,0BAAED,KAAF,EAASE,OAAT,EAAL,EAAyB;AACvBF,wBAAQ,CAACA,KAAD,CAAR;AACD;AACD,qBAAOA,MAAMD,GAAN,CAAU,UAACI,CAAD;AAAA,uBAAUF,GAAV,SAAiBD,KAAjB;AAAA,eAAV,EAAoCI,IAApC,CAAyC,GAAzC,CAAP;AACD,aALQ,EAKNA,IALM,CAKD,GALC,CAAT;AANa;AAAA,mBAYQ,eAAKC,OAAL,CAAa;AAChCC,kDAAkCd,MAAlC,SAA4CC,MADZ;AAEhCD,sBAAQ,MAFwB;AAGhCe,uBAASjB;AAHuB,aAAb,CAZR;;AAAA;AAYTkB,oBAZS;;AAAA,kBAiBT,QAAQA,SAASC,MAjBR;AAAA;AAAA;AAAA;;AAAA,6CAkBJf,QAAQC,MAAR,CAAe,IAAIC,KAAJ,CAAUP,MAAMQ,SAAN,CAAgB,8BAAhB,CAAV,CAAf,CAlBI;;AAAA;AAAA;AAAA,mBAoBIW,SAASE,IAAT,CAAcC,IAAd,EApBJ;;AAAA;AAoBTC,gBApBS;AAAA;AAAA,6CAsBJlB,QAAQmB,OAAR,CAAgBC,KAAKC,KAAL,CAAWH,KAAKI,QAAL,EAAX,CAAhB,CAtBI;;AAAA;AAAA;AAAA;AAAA,6CAwBJtB,QAAQC,MAAR,aAxBI;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","file":"helpers/vk.js","sourcesContent":["import _ from 'underscore';\nimport HTTP from 'q-io/http';\n\nimport config from '../helpers/tools';\nimport * as Tools from '../helpers/tools';\n\n\nconst VK_API_CALL_TIMEOUT = Tools.MINUTE;\n\nexport default async function(method, params) {\n  if (!method) {\n    return Promise.reject(new Error(Tools.translate('Invalid VK API method')));\n  }\n  params = params || {};\n  params.access_token = config('site.vkontakte.accessToken');\n  params = _(params).map((value, key) => {\n    if (!_(value).isArray()) {\n      value = [value];\n    }\n    return value.map((v) => `${key}=${value}`).join('&');\n  }).join('&');\n  let response = await HTTP.request({\n    url: `https://api.vk.com/method/${method}?${params}`,\n    method: 'POST',\n    timeout: VK_API_CALL_TIMEOUT\n  });\n  if (200 !== response.status) {\n    return Promise.reject(new Error(Tools.translate('Failed to call VK API method')));\n  }\n  let data = await response.body.read();\n  try {\n    return Promise.resolve(JSON.parse(data.toString()));\n  } catch (err) {\n    return Promise.reject(err);\n  }\n}\n"],"sourceRoot":"/source/"}