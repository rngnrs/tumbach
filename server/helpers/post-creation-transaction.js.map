{"version":3,"sources":["helpers/post-creation-transaction.js"],"names":["Tools","PostCreationTransaction","boardName","files","path","push","threadNumber","postNumber","_rollbackFiles","_rollbackThread","_rollbackPost","error","stack","series","exists","remove","err"],"mappings":";;;;;;;;AAAA;;;;AAEA;;;;AACA;;IAAYA,K;;;;;;;;;;IAESC,uB;AACnB,mCAAYC,SAAZ,EAAuB;AAAA;;AACrB,SAAKA,SAAL,GAAiBA,SAAjB;AACA,SAAKC,KAAL,GAAa,EAAb;AACD;;;;4BAEOC,I,EAAM;AACZ,WAAKD,KAAL,CAAWE,IAAX,CAAgBD,IAAhB;AACD;;;oCAEeE,Y,EAAc;AAC5B,WAAKA,YAAL,GAAoBA,YAApB;AACD;;;kCAEaC,U,EAAY;AACxB,WAAKA,UAAL,GAAkBA,UAAlB;AACD;;;;;;;;;;;uBAIS,KAAKC,cAAL,E;;;sBACF,KAAKF,YAAL,GAAoB,C;;;;;;uBAChB,KAAKG,eAAL,E;;;sBAEJ,KAAKF,UAAL,GAAkB,C;;;;;;uBACd,KAAKG,aAAL,E;;;;;;;;;;AAGR,iCAAOC,KAAP,CAAa,YAAIC,KAAJ,eAAb;;;;;;;;;;;;;;;;;;;;;;;;;uBAKIZ,MAAMa,MAAN,CAAa,KAAKV,KAAlB;AAAA,wEAAyB,kBAAeC,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAER,aAAGU,MAAH,CAAUV,IAAV,CAFQ;;AAAA;AAEvBU,kCAFuB;;AAAA,iCAGvBA,MAHuB;AAAA;AAAA;AAAA;;AAAA;AAAA,mCAInB,aAAGC,MAAH,CAAUX,IAAV,CAJmB;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAO3B,6CAAOO,KAAP,CAAa,aAAIC,KAAJ,gBAAb;;AAP2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAzB;;AAAA;AAAA;AAAA;AAAA,oB;;;;;;;;;;;;;;;;;;;;;;;;AAaN,oBAAI;AACF;;;;;AAKD,iBAND,CAME,OAAOI,GAAP,EAAY;AACZ,mCAAOL,KAAP,CAAaK,IAAIJ,KAAJ,IAAaI,GAA1B;AACD;;;;;;;;;;;;;;;;;;;;;;;;AAID,oBAAI;AACF;;;;;AAKD,iBAND,CAME,OAAOA,GAAP,EAAY;AACZ,mCAAOL,KAAP,CAAaK,IAAIJ,KAAJ,IAAaI,GAA1B;AACD;;;;;;;;;;;;;;;;;;;;;kBAlEgBf,uB","file":"helpers/post-creation-transaction.js","sourcesContent":["import FS from 'q-io/fs';\n\nimport Logger from './logger';\nimport * as Tools from './tools';\n\nexport default class PostCreationTransaction {\n  constructor(boardName) {\n    this.boardName = boardName;\n    this.files = [];\n  }\n\n  addFile(path) {\n    this.files.push(path);\n  }\n\n  setThreadNumber(threadNumber) {\n    this.threadNumber = threadNumber;\n  }\n\n  setPostNumber(postNumber) {\n    this.postNumber = postNumber;\n  }\n\n  async rollback() {\n    try {\n      await this._rollbackFiles();\n      if (this.threadNumber > 0) {\n        await this._rollbackThread();\n      }\n      if (this.postNumber > 0) {\n        await this._rollbackPost();\n      }\n    } catch (err) {\n      Logger.error(err.stack || err);\n    }\n  }\n\n  async _rollbackFiles() {\n    await Tools.series(this.files, async function(path) {\n      try {\n        let exists = await FS.exists(path);\n        if (exists) {\n          await FS.remove(path);\n        }\n      } catch (err) {\n        Logger.error(err.stack || err);\n      }\n    });\n  }\n\n  async _rollbackThread() {\n    try {\n      /*\n      return removeThread(_this.board.name, _this.threadNumber).catch(function(err) {\n          Logger.error(err.stack || err);\n      });\n      */\n    } catch (err) {\n      Logger.error(err.stack || err);\n    }\n  }\n\n  async _rollbackPost() {\n    try {\n      /*\n      return removePost(_this.board.name, _this.postNumber).catch(function(err) {\n          Logger.error(err.stack || err);\n      });\n      */\n    } catch (err) {\n      Logger.error(err.stack || err);\n    }\n  }\n}\n"],"sourceRoot":"/source/"}